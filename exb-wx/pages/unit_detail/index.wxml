<!-- 展览单元详情页面 -->
<view class="container">
  <!-- 返回按钮 -->
  <button class="back-btn" bindtap="goBack">
    <mp-icon type="field" icon="back" color="black" size="{{15}}"></mp-icon>
  </button>
  
  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 滚动内容区域 -->
  <scroll-view class="content" scroll-y="true" bindscroll="onScroll" scroll-top="{{scrollTop}}" enable-back-to-top="true">
    <!-- 展览单元图片轮播 -->
    <view class="swiper-container" wx:if="{{!isLoading && unit.images.length > 0}}">
      <swiper class="swiper" 
              indicator-dots="{{true}}" 
              autoplay="{{false}}" 
              interval="5000" 
              duration="500"
              bindchange="onSwiperChange"
              circular="{{true}}">
        <swiper-item wx:for="{{unit.images}}" wx:key="index">
          <view class="swiper-item">
            <image class="slide-image" 
                   src="{{static_url}}{{item.url}}" 
                   mode="aspectFill"
                   bindtap="previewImage"
                   data-index="{{index}}"></image>
          </view>
        </swiper-item>
      </swiper>
      <!-- 轮播图指示器 -->
      <view class="swiper-pagination">
        <text class="pagination-text">{{currentIndex + 1}} / {{unit.images.length}}</text>
      </view>
    </view>

    <!-- 默认封面图（如果没有图片） -->
    <view class="cover-container" wx:if="{{!isLoading && unit.images.length === 0}}">
      <image class="cover-img" src="{{static_url}}/wx_static/tmp_images/placeholder_image.png" mode="aspectFill"></image>
      <view class="cover-gradient"></view>
    </view>

    <!-- 展览单元信息 -->
    <view class="info-section" wx:if="{{!isLoading}}">
      <view class="title-section">
        <text class="unit-title">{{unit.name}}</text>
        <view class="tag-container">
          <!-- 根据单元类型显示标签 -->
          <text class="tag tag-primary" wx:if="{{unit.unitType === 0}}">展品单元</text>
          <text class="tag tag-secondary" wx:elif="{{unit.unitType === 1}}">文字单元</text>
          <text class="tag tag-accent" wx:elif="{{unit.unitType === 2}}">多媒体单元</text>
          <text class="tag tag-section" wx:if="{{unit.section}}">{{unit.section}}</text>
        </view>
      </view>

      <view class="divider"></view>
      
      <!-- 音频播放按钮 -->
      <view class="audio-section" wx:if="{{unit.hasAudio}}">
        <view class="detail-item">
          <view class="icon-container" bindtap="playUnitAudio"
            data-audio-url="{{static_url}}{{unit.audioUrl}}" 
            data-audio-name="{{unit.name || '展览单元音频'}}"
            data-album-name="{{unit.section}}"
            data-artist-name="{{exhibition.title}}"
            data-cover-url="{{static_url}}{{unit.images[0].url || '/wx_static/tmp_images/placeholder_image.png'}}">
             <mp-icon type="field" icon="{{audioState === 'playing' && currentAudioUrl === static_url + unit.audioUrl? 'pause' : 'play2'}}" color="#4299f0" size="{{30}}"></mp-icon>
          </view>
          <view class="detail-content">
            <text class="label">语音导览</text>
            <text class="value">{{audioState === 'playing' && currentAudioUrl === static_url + unit.audioUrl? '正在播放' : '点击播放'}}</text>
          </view>
        </view>
      </view>

      <!-- 展签信息 -->
      <view class="detail-list" wx:if="{{unit.exhibitLabel}}">
        <view class="detail-item">
          <view class="icon-container">
            <mp-icon type="field" icon="comment" color="#4299f0" size="{{30}}"></mp-icon>
          </view>
          <view class="detail-content">
            <text class="label">展签</text>
            <text class="value">{{unit.exhibitLabel}}</text>
          </view>
        </view>
      </view>

      <!-- 导览词 -->
      <view class="intro-section">
        <text class="section-title">导览词</text>
        <text class="intro-text">{{introText || '暂无导览词'}}</text>
        <!-- 如果导览词过长可以添加展开收起按钮 -->
        <button class="read-more-btn" bindtap="toggleIntro" wx:if="{{unit.guideText && unit.guideText.length > 100}}" style="margin-left: 0rpx;">
          <text>{{showFullIntro ? '收起' : '更多'}}</text>
          <mp-icon type="field" icon="{{showFullIntro ? 'back' : 'arrow'}}" color="#4299f0" size="{{10}}"></mp-icon>
        </button>
      </view>

    </view>
    
    <!-- 相关藏品区域 - 仅在展品单元且有关联藏品时显示 -->
    <view class="related-collections-section" wx:if="{{unit.unitType === 0 && unit.collectionsDetail && unit.collectionsDetail.length > 0}}">
      <view class="section-header">
        <text class="section-title">相关藏品</text>
      </view>
      <scroll-view scroll-x class="h-scroll">
        <view class="card" wx:for="{{unit.collectionsDetail}}" wx:key="id" bindtap="goToCollectionDetail" data-collection="{{item}}">
          <image class="card-img" src="{{static_url}}{{item.imageUrl}}" mode="aspectFill" />
          <view class="card-title">{{item.name}}</view>
          <view class="card-sub">{{item.age}}</view>
        </view>
      </scroll-view>
    </view>
  </scroll-view>
</view>